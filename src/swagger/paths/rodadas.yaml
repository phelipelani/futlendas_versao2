# Arquivo: src/swagger/paths/rodadas.yaml
tags:
  - name: Rodadas
    description: Gerenciamento das rodadas (eventos de jogos) das Ligas
paths:
  /rodadas/liga/{liga_id}:
    get:
      tags: [Rodadas, Ligas]
      summary: Lista todas as rodadas de uma liga específica
      security: [] # Pública
      parameters:
        - name: liga_id
          in: path
          required: true
          description: ID da liga
          schema:
            type: integer
            minimum: 1
      responses:
        '200':
          description: OK - Lista de rodadas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../schemas.yaml#/components/schemas/Rodada'
        '400':
          description: ID da liga inválido
        '500':
          description: Erro interno

    post:
      tags: [Rodadas, Ligas]
      summary: Cria uma nova rodada em uma liga
      security:
        - bearerAuth: []
      parameters:
        - name: liga_id
          in: path
          required: true
          description: ID da liga onde a rodada será criada
          schema:
            type: integer
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas.yaml#/components/schemas/RodadaInput'
      responses:
        '201':
          description: Rodada criada com sucesso
          content:
            application/json:
              schema:
                $ref: '../schemas.yaml#/components/schemas/Rodada'
        '400':
          description: 'Erro de validação (ex: data inválida)'
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado
        '404':
          description: Liga não encontrada
        '409':
          description: 'Conflito (já existe rodada nessa data)'
  
  /rodadas/{rodada_id}:
    put:
      tags: [Rodadas]
      summary: Atualiza a data de uma rodada
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../schemas.yaml#/components/parameters/RodadaId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas.yaml#/components/schemas/RodadaUpdateInput'
      responses:
        '200':
          description: Data da rodada atualizada
          content:
            application/json:
              schema:
                $ref: '../schemas.yaml#/components/schemas/SuccessMessage'
        '400':
          description: 'Erro de validação ou rodada já finalizada'
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado
        '404':
          description: Rodada não encontrada
        '409':
          description: 'Conflito (data já usada por outra rodada)'
    delete:
      tags: [Rodadas]
      summary: Deleta uma rodada (e todos os dados em cascata)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../schemas.yaml#/components/parameters/RodadaId'
      responses:
        '200':
          description: Rodada deletada com sucesso
          content:
            application/json:
              schema:
                $ref: '../schemas.yaml#/components/schemas/SuccessMessage'
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado
        '404':
          description: Rodada não encontrada
  
  /rodadas/{rodada_id}/jogadores:
    get:
      tags: [Rodadas, Jogadores]
      summary: Lista os jogadores confirmados em uma rodada
      security: [] # Pública
      parameters:
        - $ref: '../schemas.yaml#/components/parameters/RodadaId'
      responses:
        '200':
          description: OK - Lista de jogadores
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../schemas.yaml#/components/schemas/Jogador'
        '400':
          description: ID da rodada inválido
        '404':
          description: Rodada não encontrada
  
  /rodadas/{rodada_id}/sync-jogadores:
    post:
      tags: [Rodadas, Jogadores]
      summary: Sincroniza (cria/encontra) e substitui jogadores em uma rodada
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../schemas.yaml#/components/parameters/RodadaId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas.yaml#/components/schemas/RodadaSyncJogadoresInput'
      responses:
        '200':
          description: Jogadores sincronizados
          content:
            application/json:
              schema:
                type: object
                properties:
                  jogadores:
                    type: array
                    items:
                      $ref: '../schemas.yaml#/components/schemas/Jogador'
                  novos:
                    type: integer
                    example: 1
                  existentes:
                    type: integer
                    example: 15
        '400':
          description: 'Erro de validação (lista de nomes vazia)'
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado
        '404':
          description: Rodada não encontrada
  
  /rodadas/{rodada_id}/times:
    get:
      tags: [Rodadas]
      summary: Lista os times sorteados (jogadores e seus times)
      security: [] # Pública
      parameters:
        - $ref: '../schemas.yaml#/components/parameters/RodadaId'
      responses:
        '200':
          description: OK - Lista de jogadores com seus times
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '../schemas.yaml#/components/schemas/Jogador'
                    - type: object
                      properties:
                        numero_time:
                          type: integer
                          example: 1
                        nome_time:
                          type: string
                          example: "Time Amarelo"
        '400':
          description: ID da rodada inválido
        '404':
          description: Rodada não encontrada
    post:
      tags: [Rodadas]
      summary: Salva os times sorteados para a rodada
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../schemas.yaml#/components/parameters/RodadaId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '../schemas.yaml#/components/schemas/RodadaSaveTimesInput'
      responses:
        '200':
          description: Times guardados com sucesso
          content:
            application/json:
              schema:
                $ref: '../schemas.yaml#/components/schemas/SuccessMessage'
        '400':
          description: 'Erro de validação (payload inválido)'
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado
        '404':
          description: Rodada não encontrada
        '409':
          description: 'Conflito (ex: ID de jogador inválido)'
  
  /rodadas/{rodada_id}/partidas:
    post:
      tags: [Rodadas, Partidas (Liga)]
      summary: Cria uma nova partida (vazia) para a rodada
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../schemas.yaml#/components/parameters/RodadaId'
      responses:
        '201':
          description: Partida criada
          content:
            application/json:
              schema:
                $ref: '../schemas.yaml#/components/schemas/PartidaLiga'
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado
        '404':
          description: Rodada não encontrada
  
  /rodadas/{rodada_id}/finalizar:
    post:
      tags: [Rodadas]
      summary: Finaliza uma rodada (calcula pontos, MVPs, etc.)
      security:
        - bearerAuth: []
      parameters:
        - $ref: '../schemas.yaml#/components/parameters/RodadaId'
      responses:
        '200':
          description: Rodada finalizada com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Rodada finalizada com sucesso!"
                  # ... (propriedades do resultado da finalização) ...
        '400':
          description: 'Rodada já foi finalizada'
        '401':
          description: Não autorizado
        '403':
          description: Acesso negado
        '404':
          description: Rodada não encontrada
  
  /rodadas/{rodada_id}/resultados:
    get:
      tags: [Rodadas, Estatísticas]
      summary: Busca os resultados completos (pontuação) de uma rodada
      security: [] # Pública
      parameters:
        - $ref: '../schemas.yaml#/components/parameters/RodadaId'
      responses:
        '200':
          description: OK - Lista de resultados dos jogadores
          # (O schema de retorno aqui é complexo, pode ser definido no futuro)
        '400':
          description: ID da rodada inválido
        '404':
          description: Rodada não encontrada